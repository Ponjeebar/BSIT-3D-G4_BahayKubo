<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Transactions - BAHAY KUBO Resort</title>
    <link rel="icon" type="image/png" href="logo/logo.png">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="css/open-iconic-bootstrap.min.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
      * {
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Nunito Sans', sans-serif;
        background: #f8f9fa;
        min-height: 100vh;
        padding: 0;
        margin: 0;
      }
      
      .transaction-container {
        min-height: 100vh;
        padding: 100px 20px 50px;
        background: #f8f9fa;
      }
      
      .transaction-wrapper {
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .page-header {
        background: #fff;
        border-radius: 16px;
        padding: 30px 40px;
        margin-bottom: 30px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      }
      
      .page-header h1 {
        font-size: 32px;
        font-weight: 700;
        color: #222;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .page-header h1 i {
        color: #21cc7a;
      }
      
      .transaction-tabs {
        display: flex;
        gap: 12px;
        margin-bottom: 30px;
        background: #fff;
        padding: 8px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
      }
      
      .tab-button {
        flex: 1;
        padding: 14px 24px;
        border: none;
        background: transparent;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        color: #717171;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }
      
      .tab-button.active {
        background: #21cc7a;
        color: #fff;
        box-shadow: 0 4px 12px rgba(33, 204, 122, 0.3);
      }
      
      .tab-button:hover:not(.active) {
        background: #f7f7f7;
        color: #222;
      }
      
      .tab-content {
        display: none;
      }
      
      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .transaction-section {
        background: #fff;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
      }
      
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #f7f7f7;
      }
      
      .section-header h2 {
        font-size: 22px;
        font-weight: 700;
        color: #222;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .section-header h2 i {
        color: #21cc7a;
        font-size: 20px;
      }
      
      .transaction-count {
        background: #f7f7f7;
        color: #717171;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
      }
      
      .transaction-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .transaction-card {
        background: #fff;
        border: 2px solid #f7f7f7;
        border-radius: 12px;
        padding: 20px;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      
      .transaction-card:hover {
        border-color: #21cc7a;
        box-shadow: 0 4px 16px rgba(33, 204, 122, 0.15);
        transform: translateY(-2px);
      }
      
      .transaction-card.pending {
        border-left: 4px solid #ffa500;
        background: linear-gradient(to right, #fff7ed 0%, #fff 10%);
      }
      
      .transaction-card.completed {
        border-left: 4px solid #21cc7a;
      }
      
      .transaction-card.cancelled {
        border-left: 4px solid #dc3545;
        opacity: 0.7;
      }
      
      .transaction-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
      }
      
      .transaction-id {
        font-size: 14px;
        font-weight: 600;
        color: #717171;
        margin-bottom: 4px;
      }
      
      .transaction-id span {
        color: #222;
        font-weight: 700;
      }
      
      .transaction-date {
        font-size: 13px;
        color: #717171;
      }
      
      .transaction-status {
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .transaction-status.pending {
        background: #fff7ed;
        color: #ffa500;
        border: 1px solid #ffa500;
      }
      
      .transaction-status.completed {
        background: #d4edda;
        color: #21cc7a;
        border: 1px solid #21cc7a;
      }
      
      .transaction-status.cancelled {
        background: #f8d7da;
        color: #dc3545;
        border: 1px solid #dc3545;
      }
      
      .transaction-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-bottom: 16px;
      }
      
      .detail-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .detail-label {
        font-size: 12px;
        color: #717171;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .detail-value {
        font-size: 15px;
        color: #222;
        font-weight: 600;
      }
      
      .transaction-amount {
        font-size: 24px;
        font-weight: 700;
        color: #222;
        margin-top: 8px;
      }
      
      .transaction-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #f7f7f7;
      }
      
      .action-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .action-btn-primary {
        background: #21cc7a;
        color: #fff;
      }
      
      .action-btn-primary:hover {
        background: #1db368;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(33, 204, 122, 0.3);
      }
      
      .action-btn-secondary {
        background: #f7f7f7;
        color: #222;
      }
      
      .action-btn-secondary:hover {
        background: #e9e9e9;
      }
      
      .action-btn-danger {
        background: #fff;
        color: #dc3545;
        border: 2px solid #dc3545;
      }
      
      .action-btn-danger:hover {
        background: #dc3545;
        color: #fff;
      }
      
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #717171;
      }
      
      .empty-state i {
        font-size: 64px;
        color: #e9e9e9;
        margin-bottom: 20px;
      }
      
      .empty-state h3 {
        font-size: 20px;
        font-weight: 600;
        color: #222;
        margin-bottom: 8px;
      }
      
      .empty-state p {
        font-size: 15px;
        color: #717171;
        margin-bottom: 24px;
      }
      
      .empty-state-btn {
        display: inline-block;
        padding: 12px 24px;
        background: #21cc7a;
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
      }
      
      .empty-state-btn:hover {
        background: #1db368;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(33, 204, 122, 0.3);
        color: #fff;
        text-decoration: none;
      }
      
      @media (max-width: 768px) {
        .transaction-container {
          padding: 80px 15px 30px;
        }
        
        .page-header {
          padding: 20px;
        }
        
        .page-header h1 {
          font-size: 24px;
        }
        
        .transaction-tabs {
          flex-direction: column;
        }
        
        .transaction-details {
          grid-template-columns: 1fr;
        }
        
        .transaction-actions {
          flex-direction: column;
        }
        
        .action-btn {
          width: 100%;
          justify-content: center;
        }
      }
      
      /* Profile dropdown menu - ensure overflow is visible for submenu */
      .profile-dropdown-menu {
        overflow: visible !important;
      }
      
      /* Hide My Profile submenu and logout by default (shown when logged in) */
      .profile-dropdown-menu .profile-submenu-toggle,
      .profile-dropdown-menu .logout-link {
        display: none;
      }
      
      /* Profile submenu styles */
      .profile-submenu {
        display: none;
        position: absolute;
        left: 100%;
        top: 0;
        min-width: 180px;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        margin-left: 8px;
        padding: 8px 0;
        z-index: 10001;
        opacity: 0;
        transform: translateX(-10px);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      
      .profile-submenu-toggle.active .profile-submenu {
        display: block;
        opacity: 1;
        transform: translateX(0);
      }
      
      .profile-submenu-toggle.active i.fa-chevron-right {
        transform: rotate(90deg);
      }
      
      .profile-submenu .submenu-item {
        padding: 10px 20px;
        color: #333;
        font-size: 14px;
        font-weight: 500;
        border-left: 3px solid transparent;
        display: block;
        text-decoration: none;
        transition: all 0.2s ease;
        border-radius: 0;
      }
      
      .profile-submenu .submenu-item:first-child {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
      }
      
      .profile-submenu .submenu-item:last-child {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
      }
      
      .profile-submenu .submenu-item:hover {
        background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
        color: #21cc7a;
        border-left-color: #21cc7a;
        padding-left: 25px;
        transform: translateX(3px);
      }
      
      .profile-submenu-toggle {
        user-select: none;
        position: relative;
        overflow: visible !important;
      }
      
      .profile-dropdown-menu .profile-submenu-toggle {
        overflow: visible;
      }
      
      .profile-submenu-toggle:hover {
        background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
        color: #21cc7a;
        border-left-color: #21cc7a;
      }
      
      .profile-submenu-toggle:hover i.fa-chevron-right {
        color: #21cc7a;
      }
      
      .profile-submenu-toggle.active {
        background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%);
        color: #21cc7a;
        border-left-color: #21cc7a;
      }
      
      .profile-dropdown-menu .logout-link {
        border-top: 1px solid #e9ecef;
        margin-top: 0;
        padding: 14px 20px 12px 20px;
        border-bottom-left-radius: 12px;
        border-bottom-right-radius: 12px;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
      }
      
      .profile-dropdown-menu .logout-link:hover {
        background: linear-gradient(90deg, #f8f9fa 0%, #e9ecef 100%) !important;
        color: #dc3545;
        border-left-color: #dc3545;
        border-top-color: transparent;
        padding-left: 25px;
        transform: translateX(3px);
        margin-top: 0;
      }
      
      /* Hide navigation links but keep logo and profile in original positions */
      .navbar-nav {
        display: none !important;
      }
      
      /* Hide mobile menu toggle button */
      .navbar-toggler {
        display: none !important;
      }
      
      /* Ensure "Back to Home" and profile stay on the right */
      #ftco-nav {
        justify-content: flex-end !important;
      }
      
      /* Maintain original spacing for profile */
      #profileDropdownContainer {
        margin-left: 0 !important;
      }
      
      /* Navigation collapse styling - show flex when menu is open */
      #ftco-nav.show {
        display: flex !important;
        justify-content: space-between;
        align-items: center;
      }
      
      /* On desktop (lg and up), always show flex (Bootstrap expands navbar on lg+) */
      @media (min-width: 992px) {
        #ftco-nav {
          display: flex !important;
          justify-content: space-between;
          align-items: center;
        }
      }
      
      /* On mobile, stack items vertically when menu is open */
      @media (max-width: 991.98px) {
        #ftco-nav.show {
          flex-direction: column;
          align-items: flex-start;
        }
        
        #ftco-nav.show .navbar-nav {
          width: 100%;
          margin-bottom: 15px;
        }
        
        #ftco-nav.show #profileDropdownContainer,
        #ftco-nav.show #simpleLoginLink {
          width: 100%;
          margin-left: 0 !important;
          padding-left: 0 !important;
          border-left: none !important;
          border-top: 1px solid rgba(255, 255, 255, 0.2);
          padding-top: 15px;
          margin-top: 15px;
        }
      }
      
      /* Reduce footer size to half */
      .ftco-footer {
        padding: 3em 0 !important;
      }
      
      .ftco-footer .row.mb-5 {
        margin-bottom: 1.5rem !important;
      }
      
      .ftco-footer-widget {
        margin-bottom: 1rem !important;
      }
      
      .ftco-footer-widget h2 {
        font-size: 16px !important;
        margin-bottom: 12px !important;
      }
      
      .ftco-footer-widget p {
        font-size: 13px !important;
        line-height: 1.5 !important;
        margin-bottom: 15px !important;
      }
      
      .ftco-footer-social {
        margin-top: 1rem !important;
      }
      
      .ftco-footer-social li {
        margin-right: 8px !important;
      }
      
      .ftco-footer-social li a {
        height: 35px !important;
        width: 35px !important;
      }
      
      .ftco-footer-social li a span {
        font-size: 16px !important;
      }
      
      .ftco-footer-widget ul.list-unstyled li {
        padding: 3px 0 !important;
        font-size: 13px !important;
      }
      
      .ftco-footer-widget ul.list-unstyled li a {
        padding: 3px 0 !important;
      }
      
      .block-23 ul li {
        padding: 4px 0 !important;
        font-size: 13px !important;
        line-height: 1.5 !important;
      }
      
      .block-23 ul li .text {
        font-size: 13px !important;
      }
      
      .ftco-footer .row:last-child {
        margin-top: 1rem !important;
        padding-top: 1rem !important;
      }
      
      .ftco-footer .row:last-child p {
        font-size: 12px !important;
        margin-bottom: 0 !important;
      }
    </style>
  </head>
  <body>

    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
	    <div class="container">
	      <a class="navbar-brand" href="index.html">BAHAY <span>KUBO</span></a>
	      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
	        <span class="oi oi-menu"></span> Menu
	      </button>

	      <div class="collapse navbar-collapse" id="ftco-nav">
	        <ul class="navbar-nav">
	          <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
	          <li class="nav-item"><a href="rooms.html" class="nav-link">Our Rooms</a></li>
	          <li class="nav-item"><a href="restaurant.html" class="nav-link">Our Food</a></li>
	          <li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
	          <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
	        </ul>
	        <div style="display: flex; align-items: center; gap: 20px;">
	          <a href="index.html" class="nav-link" style="font-weight: 600; padding: 0;">Back to Home</a>
	          <div class="nav-item dropdown" id="profileDropdownContainer" style="position: relative; border-left: 1px solid rgba(255, 255, 255, 0.2); padding-left: 20px;">
	          <a class="nav-link dropdown-toggle profile-nav-link" href="#" id="profileDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="padding-left: 0; padding-right: 20px; font-weight: 600; display: flex; align-items: center; gap: 10px;">
	            <span class="nav-profile-picture" style="width: 32px; height: 32px; border-radius: 50%; overflow: hidden; border: 2px solid rgba(255, 255, 255, 0.3); display: flex; align-items: center; justify-content: center; background: #21cc7a; flex-shrink: 0;">
	              <span style="color: #fff; font-weight: 700; font-size: 14px; text-transform: uppercase;">GU</span>
	            </span>
	            <span>Profile (Guest)</span>
	          </a>
	          <div class="dropdown-menu dropdown-menu-right profile-dropdown-menu" aria-labelledby="profileDropdown" style="right: 0; left: auto;">
	            <a class="dropdown-item" href="login.html">Login / Signup</a>
	            <div class="dropdown-item profile-submenu-toggle" style="cursor: pointer; position: relative; justify-content: space-between;">
	              <span>My Profile</span>
	              <i class="fas fa-chevron-right" style="font-size: 12px; transition: transform 0.3s ease; margin-left: auto;"></i>
	              <div class="profile-submenu">
	                <a class="dropdown-item submenu-item" href="edit_profile.html">Edit Profile</a>
	                <a class="dropdown-item submenu-item" href="transaction.html">Transaction</a>
	              </div>
	            </div>
	            <a class="dropdown-item logout-link" href="#" onclick="handleLogout(); return false;">Log out</a>
	          </div>
	        </div>
	        </div>
        <div id="simpleLoginLink" style="display: none;">
          <div style="display: flex; align-items: center; gap: 20px;">
            <a href="index.html" class="nav-link" style="font-weight: 600; padding: 0;">Back to Home</a>
            <div class="nav-item" style="position: relative; border-left: 1px solid rgba(255, 255, 255, 0.2); padding-left: 20px;">
              <a href="login.html" class="nav-link login-nav-link" style="font-weight: 600; padding-left: 0;">Log in</a>
            </div>
          </div>
        </div>
	      </div>
	    </div>
	  </nav>
    <!-- END nav -->

    <div class="transaction-container">
      <div class="transaction-wrapper">
        <div class="page-header">
          <h1>
            <i class="fas fa-receipt"></i>
            My Transactions
          </h1>
        </div>

        <div class="transaction-tabs">
          <button class="tab-button active" data-tab="pending">
            <i class="fas fa-clock"></i> Pending Transactions
          </button>
          <button class="tab-button" data-tab="history">
            <i class="fas fa-history"></i> Transaction History
          </button>
        </div>

        <!-- Pending Transactions Tab -->
        <div id="pendingTab" class="tab-content active">
          <div class="transaction-section">
            <div class="section-header">
              <h2>
                <i class="fas fa-clock"></i>
                Pending Transactions
              </h2>
              <span class="transaction-count" id="pendingCount">0 pending</span>
            </div>
            <div class="transaction-list" id="pendingTransactions">
              <!-- Pending transactions will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Transaction History Tab -->
        <div id="historyTab" class="tab-content">
          <div class="transaction-section">
            <div class="section-header">
              <h2>
                <i class="fas fa-history"></i>
                Transaction History
              </h2>
              <span class="transaction-count" id="historyCount">0 transactions</span>
            </div>
            <div class="transaction-list" id="transactionHistory">
              <!-- Transaction history will be loaded here -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="ftco-footer ftco-section img" style="background-image: url(images/bg_4.jpg);">
    	<div class="overlay"></div>
      <div class="container">
        <div class="row mb-5">
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">BAHAY KUBO</h2>
              <p>More than a resort... an experience. Bahay Kubo Resort offers a unique blend of traditional Filipino architecture and modern amenities. Experience tranquility and connection with nature in our beautifully landscaped gardens, refreshing swimming pool, and renowned restaurant serving authentic Filipino cuisine.</p>
              <ul class="ftco-footer-social list-unstyled float-md-left float-lft mt-5">
                <li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
                <li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4 ml-md-5">
              <h2 class="ftco-heading-2">Useful Links</h2>
              <ul class="list-unstyled">
                <li><a href="index.html" class="py-2 d-block">Home</a></li>
                <li><a href="rooms.html" class="py-2 d-block">Our Rooms</a></li>
                <li><a href="restaurant.html" class="py-2 d-block">Our Food</a></li>
                <li><a href="blog.html" class="py-2 d-block">Blog</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
             <div class="ftco-footer-widget mb-4">
              <h2 class="ftco-heading-2">Privacy</h2>
              <ul class="list-unstyled">
                <li><a href="about.html" class="py-2 d-block">About Us</a></li>
                <li><a href="contact.html" class="py-2 d-block">Contact Us</a></li>
                <li><a href="#" class="py-2 d-block">Privacy Policy</a></li>
                <li><a href="#" class="py-2 d-block">Terms of Service</a></li>
              </ul>
            </div>
          </div>
          <div class="col-md">
            <div class="ftco-footer-widget mb-4">
            	<h2 class="ftco-heading-2">Have a Questions?</h2>
            	<div class="block-23 mb-3">
	              <ul>
	                <li><span class="icon icon-map-marker"></span><span class="text">Bahay Kubo Resort, Philippines</span></li>
	                <li><a href="tel://+639123456789"><span class="icon icon-phone"></span><span class="text">+63 912 345 6789</span></a></li>
	                <li><a href="mailto:info@bahaykuboresort.com"><span class="icon icon-envelope"></span><span class="text">info@bahaykuboresort.com</span></a></li>
	              </ul>
	            </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 text-center">
            <p>Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This system is made by BSIT-3D Group 4 Students</p>
          </div>
        </div>
      </div>
    </footer>

    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>

    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/jquery.easing.1.3.js"></script>
    <script src="js/jquery.waypoints.min.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.animateNumber.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/scrollax.min.js"></script>
    <script src="js/main.js"></script>
    <script>
      // Transaction data storage
      function getTransactions() {
        var transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
        return transactions;
      }
      
      function saveTransactions(transactions) {
        localStorage.setItem('transactions', JSON.stringify(transactions));
      }
      
      // Get current user
      function getCurrentUser() {
        var storedUser = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
        if (storedUser) {
          try {
            return JSON.parse(storedUser);
          } catch (e) {
            return null;
          }
        }
        return null;
      }
      
      // Format date
      function formatDate(dateString) {
        var date = new Date(dateString);
        var options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        return date.toLocaleDateString('en-US', options);
      }
      
      // Format currency
      function formatCurrency(amount) {
        return 'â‚±' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }
      
      // Create transaction card HTML
      function createTransactionCard(transaction) {
        var statusClass = transaction.status.toLowerCase();
        var statusText = transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1);
        
        var actionsHTML = '';
        if (transaction.status === 'pending') {
          actionsHTML = `
            <button class="action-btn action-btn-primary" onclick="viewTransactionDetails('${transaction.id}')">
              <i class="fas fa-eye"></i> View Details
            </button>
            <button class="action-btn action-btn-danger" onclick="cancelTransaction('${transaction.id}')">
              <i class="fas fa-times"></i> Cancel
            </button>
          `;
        } else if (transaction.status === 'completed') {
          actionsHTML = `
            <button class="action-btn action-btn-primary" onclick="viewTransactionDetails('${transaction.id}')">
              <i class="fas fa-eye"></i> View Details
            </button>
            <button class="action-btn action-btn-secondary" onclick="downloadReceipt('${transaction.id}')">
              <i class="fas fa-download"></i> Download Receipt
            </button>
          `;
        } else {
          actionsHTML = `
            <button class="action-btn action-btn-primary" onclick="viewTransactionDetails('${transaction.id}')">
              <i class="fas fa-eye"></i> View Details
            </button>
          `;
        }
        
        // Build details HTML based on transaction type
        var detailsHTML = '';
        if (transaction.type === 'Food Order') {
          // Food order details
          var itemCount = transaction.items ? transaction.items.reduce((sum, item) => sum + item.quantity, 0) : 0;
          detailsHTML = `
            <div class="detail-item">
              <span class="detail-label">Type</span>
              <span class="detail-value">${transaction.type}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Items</span>
              <span class="detail-value">${itemCount} item(s)</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Payment</span>
              <span class="detail-value">${transaction.paymentMethod || 'N/A'}</span>
            </div>
          `;
        } else if (transaction.type === 'Transfer Service') {
          // Transfer service details
          var transferTypeNames = {
            'airport-pickup': 'Airport Pickup',
            'airport-dropoff': 'Airport Drop-off',
            'round-trip': 'Round Trip',
            'local-transfer': 'Local Transfer',
            'city-tour': 'City Tour'
          };
          var transferTypeName = transferTypeNames[transaction.transferType] || transaction.transferType || 'N/A';
          detailsHTML = `
            <div class="detail-item">
              <span class="detail-label">Service Type</span>
              <span class="detail-value">${transferTypeName}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Pickup</span>
              <span class="detail-value">${transaction.pickupLocation || 'N/A'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Drop-off</span>
              <span class="detail-value">${transaction.dropoffLocation || 'N/A'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Date & Time</span>
              <span class="detail-value">${transaction.transferDate || 'N/A'} ${transaction.transferTime || ''}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Vehicle</span>
              <span class="detail-value">${transaction.vehicleTypeName || transaction.vehicleType || 'N/A'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Passengers</span>
              <span class="detail-value">${transaction.passengers || 'N/A'}</span>
            </div>
          `;
        } else {
          // Room booking details
          detailsHTML = `
            <div class="detail-item">
              <span class="detail-label">Type</span>
              <span class="detail-value">${transaction.type}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Check-in</span>
              <span class="detail-value">${transaction.checkin || 'N/A'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Check-out</span>
              <span class="detail-value">${transaction.checkout || 'N/A'}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Guests</span>
              <span class="detail-value">${transaction.guests || 'N/A'}</span>
            </div>
          `;
        }
        
        return `
          <div class="transaction-card ${statusClass}" onclick="viewTransactionDetails('${transaction.id}')">
            <div class="transaction-header">
              <div>
                <div class="transaction-id">Transaction ID: <span>${transaction.id}</span></div>
                <div class="transaction-date">${formatDate(transaction.date)}</div>
              </div>
              <span class="transaction-status ${statusClass}">${statusText}</span>
            </div>
            <div class="transaction-details">
              ${detailsHTML}
            </div>
            <div class="transaction-amount">${formatCurrency(transaction.amount)}</div>
            <div class="transaction-actions" onclick="event.stopPropagation();">
              ${actionsHTML}
            </div>
          </div>
        `;
      }
      
      // Load transactions
      function loadTransactions() {
        var currentUser = getCurrentUser();
        if (!currentUser || !currentUser.logged_in) {
          window.location.href = 'login.html';
          return;
        }
        
        var allTransactions = getTransactions();
        var userTransactions = allTransactions.filter(function(t) {
          return t.userId === currentUser.user_id;
        });
        
        // Separate pending and completed
        var pending = userTransactions.filter(function(t) {
          return t.status === 'pending';
        }).sort(function(a, b) {
          return new Date(b.date) - new Date(a.date);
        });
        
        var history = userTransactions.filter(function(t) {
          return t.status !== 'pending';
        }).sort(function(a, b) {
          return new Date(b.date) - new Date(a.date);
        });
        
        // Update counts
        document.getElementById('pendingCount').textContent = pending.length + ' pending';
        document.getElementById('historyCount').textContent = history.length + ' transactions';
        
        // Render pending transactions
        var pendingContainer = document.getElementById('pendingTransactions');
        if (pending.length === 0) {
          pendingContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-inbox"></i>
              <h3>No Pending Transactions</h3>
              <p>You don't have any pending transactions at the moment.</p>
              <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <a href="rooms.html" class="empty-state-btn">Book a Room</a>
                <a href="index.html" class="empty-state-btn" style="background: #2f89fc;">Book Transfer</a>
              </div>
            </div>
          `;
        } else {
          pendingContainer.innerHTML = pending.map(createTransactionCard).join('');
        }
        
        // Render transaction history
        var historyContainer = document.getElementById('transactionHistory');
        if (history.length === 0) {
          historyContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-history"></i>
              <h3>No Transaction History</h3>
              <p>Your completed and cancelled transactions will appear here.</p>
              <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <a href="rooms.html" class="empty-state-btn">Book a Room</a>
                <a href="index.html" class="empty-state-btn" style="background: #2f89fc;">Book Transfer</a>
              </div>
            </div>
          `;
        } else {
          historyContainer.innerHTML = history.map(createTransactionCard).join('');
        }
      }
      
      // Tab switching
      $('.tab-button').on('click', function() {
        var tabName = $(this).data('tab');
        
        // Update buttons
        $('.tab-button').removeClass('active');
        $(this).addClass('active');
        
        // Update content
        $('.tab-content').removeClass('active');
        if (tabName === 'pending') {
          $('#pendingTab').addClass('active');
        } else {
          $('#historyTab').addClass('active');
        }
      });
      
      // View transaction details
      window.viewTransactionDetails = function(transactionId) {
        var transactions = getTransactions();
        var transaction = transactions.find(function(t) {
          return t.id === transactionId;
        });
        
        if (transaction) {
          var details = `Transaction ID: ${transaction.id}
Status: ${transaction.status}
Date: ${formatDate(transaction.date)}
Type: ${transaction.type}
Amount: ${formatCurrency(transaction.amount)}`;
          
          if (transaction.type === 'Food Order') {
            if (transaction.items && transaction.items.length > 0) {
              details += '\n\nOrder Items:';
              transaction.items.forEach(function(item) {
                details += `\n- ${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)}`;
              });
            }
            details += `\n\nPayment Method: ${transaction.paymentMethod || 'N/A'}`;
          } else if (transaction.type === 'Transfer Service') {
            var transferTypeNames = {
              'airport-pickup': 'Airport Pickup',
              'airport-dropoff': 'Airport Drop-off',
              'round-trip': 'Round Trip',
              'local-transfer': 'Local Transfer',
              'city-tour': 'City Tour'
            };
            var transferTypeName = transferTypeNames[transaction.transferType] || transaction.transferType || 'N/A';
            details += `\n\nService Type: ${transferTypeName}
${transaction.pickupLocation ? 'Pickup Location: ' + transaction.pickupLocation : ''}
${transaction.dropoffLocation ? 'Drop-off Location: ' + transaction.dropoffLocation : ''}
${transaction.transferDate ? 'Transfer Date: ' + transaction.transferDate : ''}
${transaction.transferTime ? 'Transfer Time: ' + transaction.transferTime : ''}
${transaction.vehicleTypeName ? 'Vehicle: ' + transaction.vehicleTypeName : ''}
${transaction.passengers ? 'Passengers: ' + transaction.passengers : ''}
${transaction.luggage ? 'Luggage: ' + transaction.luggage : ''}
${transaction.contactNumber ? 'Contact Number: ' + transaction.contactNumber : ''}
${transaction.specialInstructions ? 'Special Instructions: ' + transaction.specialInstructions : ''}`;
          } else {
            details += `\n${transaction.checkin ? 'Check-in: ' + transaction.checkin : ''}
${transaction.checkout ? 'Check-out: ' + transaction.checkout : ''}
${transaction.guests ? 'Guests: ' + transaction.guests : ''}
${transaction.paymentMethod ? 'Payment Method: ' + transaction.paymentMethod : ''}`;
          }
          
          alert(details);
        }
      };
      
      // Cancel transaction
      window.cancelTransaction = function(transactionId) {
        if (!confirm('Are you sure you want to cancel this transaction?')) {
          return;
        }
        
        var transactions = getTransactions();
        var transaction = transactions.find(function(t) {
          return t.id === transactionId;
        });
        
        if (transaction && transaction.status === 'pending') {
          transaction.status = 'cancelled';
          saveTransactions(transactions);
          loadTransactions();
          
          // Switch to history tab if pending is now empty
          var pending = transactions.filter(function(t) {
            return t.status === 'pending' && t.userId === getCurrentUser().user_id;
          });
          if (pending.length === 0) {
            $('.tab-button[data-tab="history"]').click();
          }
        }
      };
      
      // Download receipt
      window.downloadReceipt = function(transactionId) {
        var transactions = getTransactions();
        var transaction = transactions.find(function(t) {
          return t.id === transactionId;
        });
        
        if (transaction) {
          // Create receipt content
          var receiptContent = `BAHAY KUBO RESORT
RECEIPT

Transaction ID: ${transaction.id}
Date: ${formatDate(transaction.date)}
Status: ${transaction.status.toUpperCase()}

${transaction.type}
`;
          
          if (transaction.type === 'Food Order') {
            if (transaction.items && transaction.items.length > 0) {
              receiptContent += '\nOrder Items:\n';
              transaction.items.forEach(function(item) {
                receiptContent += `- ${item.name} x${item.quantity} - $${(item.price * item.quantity).toFixed(2)}\n`;
              });
            }
          } else if (transaction.type === 'Transfer Service') {
            var transferTypeNames = {
              'airport-pickup': 'Airport Pickup',
              'airport-dropoff': 'Airport Drop-off',
              'round-trip': 'Round Trip',
              'local-transfer': 'Local Transfer',
              'city-tour': 'City Tour'
            };
            var transferTypeName = transferTypeNames[transaction.transferType] || transaction.transferType || 'N/A';
            receiptContent += `Service Type: ${transferTypeName}\n
${transaction.pickupLocation ? 'Pickup Location: ' + transaction.pickupLocation + '\n' : ''}
${transaction.dropoffLocation ? 'Drop-off Location: ' + transaction.dropoffLocation + '\n' : ''}
${transaction.transferDate ? 'Transfer Date: ' + transaction.transferDate + '\n' : ''}
${transaction.transferTime ? 'Transfer Time: ' + transaction.transferTime + '\n' : ''}
${transaction.vehicleTypeName ? 'Vehicle: ' + transaction.vehicleTypeName + '\n' : ''}
${transaction.passengers ? 'Passengers: ' + transaction.passengers + '\n' : ''}
${transaction.luggage ? 'Luggage: ' + transaction.luggage + '\n' : ''}
${transaction.contactNumber ? 'Contact Number: ' + transaction.contactNumber + '\n' : ''}
${transaction.specialInstructions ? 'Special Instructions: ' + transaction.specialInstructions + '\n' : ''}`;
          } else {
            receiptContent += `${transaction.checkin ? 'Check-in: ' + transaction.checkin + '\n' : ''}
${transaction.checkout ? 'Check-out: ' + transaction.checkout + '\n' : ''}
${transaction.guests ? 'Guests: ' + transaction.guests + '\n' : ''}`;
          }
          
          receiptContent += `\nTotal Amount: ${formatCurrency(transaction.amount)}
Payment Method: ${transaction.paymentMethod || 'N/A'}

Thank you for your ${transaction.type === 'Food Order' ? 'order' : 'booking'}!`;
          
          // Create and download file
          var blob = new Blob([receiptContent], { type: 'text/plain' });
          var url = window.URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = url;
          a.download = 'receipt-' + transaction.id + '.txt';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        }
      };
      
      // Profile dropdown functionality
      $(document).ready(function() {
        // Update profile display
        function updateProfileDisplay() {
          var currentUser = getCurrentUser();
          var $profileText = $('#profileDropdown span:last-child');
          var $profileInitials = $('#profileDropdown .nav-profile-picture span');
          var $loginLink = $('.profile-dropdown-menu .dropdown-item[href="login.html"]');
          var $profileContainer = $('#profileDropdownContainer');
          var $simpleLoginLink = $('#simpleLoginLink');
          
          if (currentUser && currentUser.logged_in) {
            $profileContainer.show();
            $simpleLoginLink.hide();
            var firstName = currentUser.first_name || '';
            var lastName = currentUser.last_name || '';
            var fullName = (firstName + ' ' + lastName).trim() || currentUser.username || 'User';
            
            $profileText.text('Profile (' + fullName + ')');
            
            var users = JSON.parse(localStorage.getItem('users') || '[]');
            var user = users.find(u => u.id === currentUser.user_id);
            
            var $profilePicture = $('#profileDropdown .nav-profile-picture');
            var existingImg = $profilePicture.find('img');
            
            if (user && user.avatar) {
              if (existingImg.length > 0) {
                existingImg.attr('src', user.avatar);
              } else {
                $profileInitials.remove();
                $profilePicture.append('<img src="' + user.avatar + '" alt="Profile Picture" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">');
              }
              $profilePicture.css('background', 'transparent');
            } else {
              if (existingImg.length > 0) {
                existingImg.remove();
                $profilePicture.append('<span style="color: #fff; font-weight: 700; font-size: 14px; text-transform: uppercase;"></span>');
                $profileInitials = $profilePicture.find('span');
              }
              $profilePicture.css('background', '#21cc7a');
              
              var initials = '';
              if (firstName && lastName) {
                initials = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase();
              } else if (currentUser.username) {
                initials = currentUser.username.substring(0, 2).toUpperCase();
              } else {
                initials = 'GU';
              }
              $profileInitials.text(initials);
            }
            
            $loginLink.hide();
            $('.profile-dropdown-menu .profile-submenu-toggle').show();
            $('.profile-dropdown-menu .logout-link').show();
          } else {
            $profileContainer.hide();
            $simpleLoginLink.show();
          }
        }
        
        updateProfileDisplay();
        
        // Dropdown toggle
        var $profileDropdown = $('#profileDropdown');
        var $profileMenu = $profileDropdown.next('.profile-dropdown-menu');
        var $profileContainer = $profileDropdown.closest('.dropdown');
        
        $profileDropdown.on('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          var isOpen = $profileMenu.hasClass('show');
          
          $('.dropdown-menu').not($profileMenu).removeClass('show');
          $('.dropdown-toggle').not($profileDropdown).attr('aria-expanded', 'false');
          
          if (isOpen) {
            $profileMenu.removeClass('show');
            $profileDropdown.attr('aria-expanded', 'false');
          } else {
            $profileMenu.removeClass('show');
            $profileMenu[0].offsetHeight;
            $profileMenu.addClass('show');
            $profileDropdown.attr('aria-expanded', 'true');
          }
        });
        
        $(document).on('click', function(e) {
          if (!$(e.target).closest('.dropdown').length) {
            $profileMenu.removeClass('show');
            $profileDropdown.attr('aria-expanded', 'false');
            // Close submenu when clicking outside
            $('.profile-submenu-toggle').removeClass('active');
          }
        });
        
        // My Profile submenu toggle
        $(document).on('click', '.profile-submenu-toggle', function(e) {
          e.stopPropagation();
          var $toggle = $(this);
          var $submenu = $toggle.find('.profile-submenu');
          
          // Toggle active class
          $toggle.toggleClass('active');
          
          // Close other submenus if any
          $('.profile-submenu-toggle').not($toggle).removeClass('active');
        });
        
        // Close submenu when clicking on submenu items
        $(document).on('click', '.profile-submenu .submenu-item', function() {
          $('.profile-submenu-toggle').removeClass('active');
        });
        
        // Close submenu when clicking outside the submenu
        $(document).on('click', function(e) {
          if (!$(e.target).closest('.profile-submenu-toggle').length && 
              !$(e.target).closest('.profile-submenu').length) {
            $('.profile-submenu-toggle').removeClass('active');
          }
        });
        
        window.handleLogout = function() {
          localStorage.removeItem('currentUser');
          sessionStorage.removeItem('currentUser');
          document.cookie.split(";").forEach(function(c) { 
            document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
          });
          setTimeout(function() {
            window.location.href = 'index.html';
          }, 500);
        };
        
        // Load transactions
        loadTransactions();
      });
    </script>
  </body>
</html>

